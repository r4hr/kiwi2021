---
title: "2° Encuesta KIWI de Sueldos de RRHH para Latam 2021"
author: "R4HR Club de R para RRHH"
date: "29/11/2021"
output: 
  html_document:
    theme: cosmo
    highlight: haddock
    toc: true
    toc_float: true
    code_folding: hide
    code_download: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, fig.retina = 3, out.width = "80%", fig.align = "center")
```

# Introducción

[R4HR Club de R para RRHH](https://r4hr.club) es una comunidad de aprendizaje de programación de R para profesionales y estudiantes que trabajen o quieran trabajar en RRHH.

Somos una comunidad que usa mayormente datos de ejemplo relacionados con RRHH, y que genera contenido en castellano para eliminar las barreras en el aprendizaje y facilitar que más personas adopten las herramientas de análisis de datos en sus trabajos.

Para saber más de nosotros te invitamos a leer [este post](https://r4hr.club/2020/09/23/el-club-de-r-para-rrhh/).

También podés ver todo el contenido que generamos en los siguientes links:

`r icons::fontawesome("google-drive")` [Google Drive](https://drive.google.com/drive/folders/1Qck3z_t6XLRXb2vbN-00931DgdJZ0yse?usp=sharing)

`r icons::fontawesome("youtube")` [YouTube](https://youtube.com/playlist?list=PLZuVytUJrxQlcqu6l-P3ou4vV2mRJU2Ka)

`r icons::fontawesome("github")` [Github](https://github.com/r4hr/)

`r icons::fontawesome("link")` También te invitamos a seguirnos en todas [nuestras redes sociales](https://linktr.ee/r4hrclub).

Pueden acceder a los datos crudos desde [este link](https://docs.google.com/spreadsheets/d/1LDdXlIwrcsyuywbcS4gdc-1p6wBXfEfL2Y6sNBj-4GM/edit?usp=sharing).

```{r preproceso}
# Carga de librerías 
# Instalar pacman install.packages("pacman")

pacman::p_load(tidyverse, funModeling, gt, googlesheets4,gt, CGPfunctions,
               extrafont, scales, ggalt, kableExtra, wordcloud, networkD3,
               data.table)


# Carga de Datos ----
# Datos --------

## 2021 ----

# Encuesta
kiwi21 <- read.csv("https://raw.githubusercontent.com/r4hr/kiwi2021/main/data/rh_2021.csv",
                   sep = ";",
                   encoding = "UTF-8") 

kiwi20 <- read.csv("https://raw.githubusercontent.com/r4hr/kiwi2021/main/data/rh_2020.csv", 
                   sep = ";",
                   encoding = "UTF-8")

freelo21 <- read.csv("https://raw.githubusercontent.com/r4hr/kiwi2021/main/data/freelancers_2021.csv",
                     sep = ";",
                     encoding = "UTF-8")

kiwi21_original <- read_sheet("1nhpqDWuJoWhiVj0rIaV51-SdfnSxTpbV3Vcd3iYmyTw")

# Configuraciones generales ----

options(scipen = 999)   # Modifica la visualización de los ejes numérico a valores nominales

loadfonts(quiet = TRUE) # Permite cargar en R otros tipos de fuentes.

# Estilo limpio sin líneas de fondo
estilo <- theme(panel.grid = element_blank(),
                plot.background = element_rect(fill = "#FBFCFC"),
                panel.background = element_blank(),
                text = element_text(family = "Roboto"))

# Estilo limpio con líneas de referencia verticales en gris claro
estilov <- theme(panel.grid = element_blank(),
                 plot.background = element_rect(fill = "#FBFCFC"),
                 panel.background = element_blank(),
                 panel.grid.major.x = element_line(color = "#AEB6BF"),
                 text = element_text(family = "Roboto"))

# Estilo limpio con líneas de referencia horizontales en gris claro
estiloh <- theme(panel.grid = element_blank(),
                 plot.background = element_rect(fill = "#FBFCFC"),
                 panel.background = element_blank(),
                 panel.grid.major.y = element_line(color = "#AEB6BF"),
                 text = element_text(family = "Roboto"))

genero <- c("#1FC3AA", "#8624F5", "#FFD129", "#75838F") # Verde - Violeta - Amarillo - Gris
genero3 <- c("#8624F5","#FFD129", "#1FC3AA")

colores <-  c("#8624F5", "#1FC3AA")

azul <- "#344D7E"
verde <-  "#4A9FC7"
rosa1 <- "#B95192"
rosa2 <- "#EE5777"
naranja <- "#FF764C"
amarillo <- "#FFA600"
gris <- "#75838F"
lila <- "#755395"
rojo <- "#943126"

col4 <- c(azul, lila, rosa1, rosa2)
col5 <- c(azul, lila, rosa1, rosa2, naranja)
col6 <- c(azul, lila, rosa1, rosa2, naranja, amarillo)

# Creo un objeto con un texto que se va a repetir mucho a lo largo del análisis
fuente <- "Fuente: Encuesta KIWI de Sueldos de RRHH para Latam 2021"

# Creo objetos para formatear las etiquetas numéricas de los ejes x e y
eje_x_n <- scale_x_continuous(labels = comma_format(big.mark = ".", decimal.mark = ","))

eje_y_n <- scale_y_continuous(labels = comma_format(big.mark = ".", decimal.mark = ","))


# Cantidad de respuestas 

rtas21 <- nrow(kiwi21_original)

rtas21_perc <- percent(1- (rtas21 / 762))

rtas_pais <- kiwi21_original %>% 
  select(pais = `País en el que trabajas`) %>% 
  distinct(pais) %>% 
  count() %>% 
  pull()


# Reorganizar puestos jerárquicamente
kiwi21 <- kiwi21 %>% 
  mutate(puesto = factor(puesto, 
                         levels = c("Director", "Gerente", "Jefe", 
                                    "Responsable", "HRBP", "Analista",
                                    "Administrativo", "Pasante")))
```

# Motivaciones

Como en RRHH trabajamos con datos sensibles, es complejo conseguir datos para practicar cuando estás aprendiendo sobre People Analytics, especialmente la parte práctica. Por eso, e inspirados en la Encuesta de [SysArmy](https://sysarmy.com/blog/posts/resultados-de-la-encuesta-de-sueldos-2020-2/), una comunidad de tecnología, que entre otras cosas, organiza eventos como **Nerdearla**.

Por esta razón hicimos nuestra propia encuesta, relevando datos de profesionales que trabajan tanto bajo relación de dependencia como de manera freelance. El relevamiento de datos lo hicimos entre el 22 de octubre y el 22 de noviembre de 2021.

En esta edición recibimos en total `r rtas21` respuestas (un `r rtas21_perc` menos que en 2020), de `r rtas_pais` países diferentes.

```{r rtas_pais_tabla}
kiwi21 %>% 
  group_by(pais) %>% 
  tally(sort = T) %>% 
  rename("País" = pais,
         "Respuestas" = n) %>% 
  kbl(caption = "Respuestas por País", ) %>% 
  kable_styling(full_width = F, position = "center",
                bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>% 
  footnote(general = fuente)
```

Del total de respuestas recibidas, `r nrow(kiwi21_original) - nrow(freelo21)` son de personas que trabajan en relación de dependencia en RRHH, mientras que `r nrow(freelo21)` personas trabajan de manera freelance.

```{r}
kiwi21_original %>% 
  select(Trabajo) %>% 
  group_by(Trabajo) %>% 
  count() %>% 
  ggplot(aes(x = n, y = Trabajo)) +
  geom_col(fill = azul) +
  estilov +
  geom_text(aes(label = n), # Indica la cantidad de decimales
            size = 3,       # Cambia el tamaño de la letra
            hjust = 1.2,    # Mueve la etiqueta para la izquierda
            color = "white",
            family = "Roboto") +
  labs(title = "Respuestas por tipo de trabajador", 
       x = "", y = "", 
       caption = fuente)
```

En esta edición decidimos realizar los análisis de género en términos de **Identidad de Género** para intentar abarcar con nuestro análisis la diversidad en términos de identidad de género. Es por esta razón que, a diferencia de la primera edición donde los análisis los hicimos en términos de *Mujer/Hombre* este año lo hicimos en términos de *Mujer cis/Mujer trans* y *Hombre cis/Hombre trans* para poder reflejar con mayor precisión el abánico de identidades y percepciones.

> El térmiino *"cis"* hace referencia a que la persona se identifica con el mismo género con el que nació.

Le agradecemos mucho a [Ivana Feldeberg](https://www.linkedin.com/in/ivana-feldfeber/) del [Observatorio de Datos con Perspectiva de Género](https://www.datagenero.org/) por el asesoramiento en este apartado.

Dicho esto, las respuestas según la identidad de género de las personas que participaron es la siguiente:

```{r fig.show='hold', out.width="50%", fig.align='default'}

# Gráfico para relación de dependencia----
div <- kiwi21 %>% 
  select(genero) %>% 
  mutate(genero = factor(genero, 
                         levels = c("Mujer cis", "Hombre cis", 
                                    "Prefiero no responder", "Gay"))) %>% 
  group_by(genero) %>% 
  summarise (n = n()) %>% 
  mutate(freq = n/sum(n)) %>% 
  arrange(-n)

# Compute the cumulative percentages (top of each rectangle)
div$ymax <- cumsum(div$freq)

# Compute the bottom of each rectangle
div$ymin <- c(0, head(div$ymax, n=-1))

# Compute label position
div$labelPosition <- (div$ymax + div$ymin) / 2

# Compute a good label
div$label <- paste0(div$genero, "\n Cant: ", div$n)

# Make the plot
ggplot(div, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=genero)) +
  geom_rect() +
  coord_polar(theta="y") + # Try to remove that to understand how the chart is built initially
  xlim(c(2, 4)) +# Try to remove that to see how to make a pie chart
  scale_fill_manual(values = c("#8624F5",  "#1FC3AA", "#FFD129","#75838F")) +
  theme_void() +
  theme(legend.position = "top",
        panel.background = element_blank(),
        plot.title.position = "plot",
        text = element_text(family = "Roboto")) +
  labs(title = "Cantidad de respuestas según género",
       subtitle = "Relación de Dependencia",
       fill = "Género", 
       caption = fuente)

# Gráfico de freelancers ----
freelo21 <- freelo21 %>% 
  mutate(genero = fct_collapse(genero, "Mujer cis" = c("Mujer cis", "Mujer"),
                               "Hombre cis" = c("Hombre cis")),
         genero = factor(genero, levels = c("Mujer cis", "Hombre cis",
                                             "Prefiero no responder", "No binario")))

div <- freelo21 %>% 
  select(genero) %>% 
  group_by(genero) %>% 
  summarise (n = n()) %>% 
  mutate(freq = n/sum(n)) %>% 
  arrange(-n)

# Compute the cumulative percentages (top of each rectangle)
div$ymax <- cumsum(div$freq)

# Compute the bottom of each rectangle
div$ymin <- c(0, head(div$ymax, n=-1))

# Compute label position
div$labelPosition <- (div$ymax + div$ymin) / 2

# Compute a good label
div$label <- paste0(div$genero, "\n Cant: ", div$n)

# Make the plot
ggplot(div, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=genero)) +
  geom_rect() +
  coord_polar(theta="y") + # Try to remove that to understand how the chart is built initially
  xlim(c(2, 4)) +# Try to remove that to see how to make a pie chart
  scale_fill_manual(values = c("#8624F5",  "#1FC3AA", "#FFD129","#75838F")) +
  theme_void() +
  theme(legend.position = "top",
        panel.background = element_blank(),
        plot.title.position = "plot",
        text = element_text(family = "Roboto")) +
  labs(title = "Cantidad de respuestas según género",
       subtitle = "Freelancers",
       fill = "Género", 
       caption = fuente)

```

En resumen, más de dos tercios de las personas que participaron de esta encuesta son mujeres cis. Algo que reflejan los datos es que en las áreas de Recursos Humanos, la diversidad de identidades de género es prácticamente nula.

```{r genero_participantes}
kiwi21_original %>% 
    mutate(genero = fct_collapse(`Identidad de Género`, "Mujer cis" = c("Mujer cis", "Mujer", "mujer",
                                                       "Mujer heterosexual"),
                               "Hombre cis" = c("Hombre cis", "Hombre", 
                                                "Hombre hetero. Que es cis?",
                                                "Hombre heterosexual")),
         genero = factor(genero, levels = c("Mujer cis", "Hombre cis",
                                            "Gay", "Prefiero no responder", "No binario"))) %>% 
  group_by(genero) %>% 
  tally(sort = T) %>% 
  mutate(Porcentaje = n/sum(n),
         Porcentaje = percent(Porcentaje, accuracy = 0.1)) %>% 
  rename("Género" = genero, 
         "Cantidad" = n) %>% 
  kbl(caption = "Total de Participantes según\nIdentidad de Género") %>% 
  kable_styling(full_width = F, position = "center",
                bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>% 
  footnote(general = fuente, general_title = "")
  


```


# Análisis de remuneraciones
## Remuneraciones por país

En esta sección nos dedicaremos a comparar los sueldos entre los países. En primer lugar, hay que resaltar que los resultados no son representativos de los mercados de los países, sino que lo son de los datos recolectados.

Por otra parte, la baja cantidad de respuestas recolectadas de otros países fuera de la Argentina, nos hace imposible, hacer un análisis comparado representativo de los puestos. Sin embargo, hay algunos datos intresantes para analizar.

Primero, analicemos los sueldos de los trabajadores en relación de dependencia, de cuyos países hayamos recibido al menos 5 respuestas.

```{r sueldo_pais1}
sueldos_dolar <- kiwi21 %>% 
  select(puesto, sueldo_dolar, pais, tipo_contratacion) %>% 
  filter(puesto != "Pasante", tipo_contratacion != "Pasante")

# Eliminamos los sueldos que están dentro del rango entre los percentiles 5 y 95
numericos <- profiling_num(sueldos_dolar)
poda_p05 <- numericos[1,6]
poda_p95 <- numericos[1,10]

# Dado que los percentiles 5 y 95 están en U$422 y 3300 respectivamente, 
# podamos todo lo que esté fuera de ese rango

media_pais <- sueldos_dolar %>% 
  filter(pais %in% c("Argentina", "Perú", "Bolivia", "Costa Rica", "Uruguay", 
                     "Chile", "México", "Paraguay", "Ecuador"),
         between(sueldo_dolar,poda_p05,poda_p95)) %>% 
  group_by(pais) %>% 
  summarise(sueldop = list(mean_se(sueldo_dolar))) %>% 
  unnest(cols = c(sueldop)) 
 
sueldo_dolar_pais <- kiwi21 %>% 
  select(pais, sueldo_dolar) %>% 
  filter(between(sueldo_dolar, poda_p05, poda_p95),
         pais %in% c("Argentina", "Perú", "Bolivia", "Costa Rica", "Uruguay", 
                     "Chile", "México", "Paraguay", "Ecuador"))

# Gráfico
ggplot(media_pais, aes(reorder(pais, -y), y =  y))+
  geom_col(fill = azul, alpha = 0.85) +
  geom_errorbar(aes(ymin = ymin,ymax = ymax), position = "dodge", color = "#333e47")+
  geom_point(data = sueldo_dolar_pais, aes(x = pais, y = sueldo_dolar), 
             alpha = 0.3, size = 2, color = "#75838F",
             position = position_jitter(width = 0.15))+
  geom_text(aes(label = comma(round(x=y, 0), big.mark = ".", 
                              decimal.mark = ","),
                vjust = 1.5, fontface = "bold"), 
            size = 4, color = "white",
            family = "Roboto")+
  eje_y_n +
  labs(title = "Salario promedio por país",
       subtitle = "Sueldos de RRHH en U$S",
       caption = paste0(fuente,"\nPaíses con más de 5 respuestas"),
       x = "", y = "") + 
  estiloh
```

A pesar de la baja cantidad de respuestas, se repite la tendencia del 2020 en donde **Uruguay** y **Chile** tienen en promedio los sueldos más altos de la región.

## Análisis de sueldos por puestos en Latinoamérica

```{r sueldo_puesto}
kiwi21 %>% 
  select(puesto, sueldo_dolar) %>% 
  filter(puesto != "Pasante",
         between(sueldo_dolar, poda_p05, poda_p95)) %>% 
  group_by(puesto) %>% 
  summarise(mediana_salarial = median(sueldo_dolar)) %>% 
  ggplot(aes(x = mediana_salarial, y = fct_rev(puesto))) +
  geom_col(fill = azul) +
  estilov +
  labs(title = "Mediana salarial por puesto", 
       subtitle = "Sueldos de RRHH en U$S", 
       x = "", y = "", 
       caption = fuente) +
  eje_x_n
```

La razón por la cual la mediana salarial de las personas en puesto de **Dirección** es menor a la de las personas en puestos de **Gerente** se explica por el tamaño de la muestra y las respuestas recibidas. En la tabla a continuación incorpora la cantidad de respuestas recibidas para cada uno de estas posiciones.

```{r sueldo_puesto_tabla}
gt(kiwi21 %>% 
     select(puesto, sueldo_dolar) %>% 
     filter(puesto != "Pasante") %>% 
     group_by(puesto) %>% 
     summarise(mediana_salarial = median(sueldo_dolar), 
               cant = n())
     ) %>% 
  tab_header(title = "Mediana salarial por puestos", 
             subtitle = "Sueldos en U$D") %>% 
  tab_source_note(source_note = fuente) %>% 
   fmt_currency(columns =  "mediana_salarial", decimals = 0,
               sep_mark = ".", dec_mark = ",") %>% 
  cols_label(puesto = "Posición",
             mediana_salarial = "Mediana Sueldo",
             cant = "Respuestas") 
```

## Sueldos según el origen del capital

Si dividimos los gráficos según el *Origen del Capital*, podemos apreciar que en líneas generales, la mediana salarial en empresas multinaciones es mayor que en las empresas nacionales. Solamente en las posiciones de **HRBP** y de **Gerente** se aprecia una paridad salarial respecto del origen del capital de la organización.

```{r origen_capital}
kiwi21 %>% 
  select(origen_capital, puesto, sueldo_dolar) %>% 
  filter(puesto != "Pasante", 
         between(sueldo_dolar, poda_p05, poda_p95)) %>% 
  group_by(puesto, origen_capital) %>% 
  summarise(mediana_salarial = median(sueldo_dolar)) %>% 
  ggplot(aes(x = mediana_salarial, y = fct_rev(puesto), fill = origen_capital)) +
  geom_col() +
  geom_text(aes(label = round(x=mediana_salarial, 0), hjust = 1.2, fontface = "bold"),size = 3, color = "white") +
  scale_fill_manual(values = c(verde, azul)) +
  estilov +
  eje_x_n +
  facet_wrap(~origen_capital) +
  labs(title = "Mediana salarial por puesto según origen del capital", 
       subtitle = "Sueldos de RRHH en U$S", 
       x = "", y = "", fill = "", 
       caption = fuente) +
  theme(legend.position = "top")
```

Veamos este gráfico de otra manera:

```{r origen_capital_slope}

slope_df <- kiwi21 %>% 
  select(puesto, sueldo_dolar, origen_capital) %>% 
  filter(between(sueldo_dolar, poda_p05, poda_p95)) %>% 
  group_by(puesto, origen_capital) %>% 
  summarise(mediana_salarial = round(median(sueldo_dolar)))

newggslopegraph(dataframe = slope_df,
                Times = origen_capital,
                Measurement = mediana_salarial,
                Grouping = puesto,
                Title = "Diferencias entre sueldos de RRHH en empresas nacionales y multinacionales",
                SubTitle = "Mediana Salarial. Sueldos en U$S",
                Caption = fuente, WiderLabels = T
                
                )
```

## Análisis por rubro y origen del capital

Para el análisis de los rubros de la empresa, vamos a filtrar los 5 rubros que tienen más respuestas. También eliminaremos del análisis el puesto de Director porque no se encuentra presente en todos los rubros.

```{r rubros, fig.height=15}
top_5_rubros <- kiwi21 %>% 
  select(rubro) %>% 
  group_by(rubro) %>% 
  count(sort = TRUE) %>%
  filter(rubro != "Otros", n > 30) %>% 
  pull(var = rubro)


kiwi21 %>% 
  select(rubro, origen_capital, puesto, sueldo_dolar) %>% 
  filter(puesto != "Pasante", puesto != "Director",
         between(sueldo_dolar, poda_p05, poda_p95),
         rubro %in% top_5_rubros) %>% 
  group_by(rubro, puesto, origen_capital) %>% 
  summarise(mediana_salarial = median(sueldo_dolar)) %>% 
  ggplot(aes(x = mediana_salarial, y = fct_rev(puesto), 
             fill = origen_capital)) +
  geom_col() +
  geom_text(aes(label = round(x=mediana_salarial, 0), 
                hjust = 1.2, 
                fontface = "bold"),
            size = 3, 
            color = "white") +
  scale_fill_manual(values = c(verde, azul)) +
  estilo +
  eje_x_n +
  facet_grid(rubro~origen_capital) +
  labs(title = "Mediana salarial por puesto según origen del capital", 
       subtitle = "Sueldos de RRHH en U$S", 
       x = "", y = "", fill = "", 
       caption = fuente) +
  theme(legend.position = "top")
```

Para ver las medianas salariales por rubros junto con el desvío estándar, pueden ver la siguiente tabla:

```{r rubros2}
  kiwi21 %>% 
    select(rubro, sueldo_dolar) %>% 
    filter(between(sueldo_dolar, poda_p05, poda_p95)) %>% 
    group_by(rubro) %>% 
    summarise(mediana_salarial = round(median(sueldo_dolar)),
              desvio_salarial = round(sd(sueldo_dolar)),
              Respuestas = n()) %>% 
    arrange(-mediana_salarial) %>% 
  kbl(caption = "Mediana salarial por rubro. En U$S", 
      col.names = c("Rubro", "Mediana Salarial","Desvío", "Respuestas")) %>% 
  kable_styling(full_width = F, position = "center",
              bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>% 
  scroll_box(height = "500px")
  

```

# Sueldos por países

Si bien la mayor cantidad de respuestas la recibimos de personas trabajando en Argentina, en esta edición decidimos incluir a todos los países de los que obtuvimos al menos 10 respuestas (Argentina, Perú, Bolivia, Costa Rica, Uruguay y Chile). Si bien la cantidad de respuestas no  nos permiten realizar análisis muy profundos queremos agradecer a las personas que respondieron realizando aunque más no sea un breve análisis.

Como primeros pasos, vamos a filtrar los datos correspondientes a cada país, y luego filtramos los sueldos que estén entre los percentiles 5 y 95, para eliminar valores espurios o extremos que ensucien el análisis.

También eliminamos el puesto de Director del análisis y las respuestas con Género diverso por la baja cantidad de respuestas.

Otra conversión que hicimos fue pasar los sueldos de las personas que trabajan part-time a una equivalencia full-time multiplicando por 1.5 el sueldo completado en la encuesta.

En esta instancia, también simplificamos los nombres de algunos rubros para mejorar las visualizaciones de los resultados.

## Perú

```{r peru1}
kiwi21 <- kiwi21 %>% 
  filter(between(sueldo_dolar, poda_p05, poda_p95),
         puesto != "Director", puesto != "Pasante",
         genero %in% c("Mujer cis", "Hombre cis"),
         anios_experiencia < 50) %>% 
  mutate(rubro = fct_recode(rubro, "Servicios financieros" = "Servicios financieros; seguros",
                             "Transporte" = "Transporte (incluyendo aviación civil; ferrocarriles por carretera)",
                            "Ind. Automotriz y Autopartistas" = "Terminales automotrices, fábricas autopartistas, y afines",
                            "Tecnología" = "Tecnologías de Información, Sistemas, y afines",
                            "Ind. Petrolera" = "Petróleo y producción de gas; refinación de petróleo"),
         multiplicador = if_else(tipo_contratacion == "Part time", 1.5, 1),
         sueldo_ft = sueldo_bruto * multiplicador)

# Análisis Perú
rh_pe <- kiwi21 %>% 
  filter(pais == "Perú")



```

### Análisis salarial por género y puestos

En el siguiente gráfico podemos ver la distribución de los sueldos por género. En este tipo de gráficos, llamados boxplots podemos ver:

* **Primer cuartil**: La parte inferior de la caja.
* **Mediana**: La línea gruesa dentro de cada rectángulo.
* **Tercer cuartil**: La parte superior de la caja
* **Outliers**: son los valores extremos identificados con puntos.

A este gráfico lo combinamos con un scatterplot para poder ver la cantidad de registros.

```{r peru2}
ggplot(rh_pe, aes(x = genero, y = sueldo_bruto, fill = genero)) +
  geom_boxplot(alpha = 0.6) +
  geom_point(position = position_jitter(width = 0.08), size = 2) +
  scale_fill_manual(values = genero) +
  estiloh + 
  eje_y_n +
  labs(title = "Distribución de sueldos por género",
       subtitle = "Datos de Perú - En S/",
       x = "", y = "Soles S/",
       fill = "Género",
       caption = fuente)

```

En el siguiente gráfico podemos ver los sueldos promedios para cada posición y género. En algunas posiciones y género sólo tenemos una sola respuesta, por eso las barras de error no aparecen.

```{r peru3}

rh_pe %>% 
  group_by(puesto, genero) %>% 
  summarise(sueldop = list(mean_se(sueldo_bruto))) %>% 
  unnest(cols = c(sueldop)) %>% 
  ggplot(aes(x = fct_rev(puesto), y = y, fill = genero)) +
  geom_col(position = "dodge") +
  geom_errorbar(aes(ymin = ymin,ymax = ymax), position = "dodge", color = "#333e47") +
  geom_text(aes(label = comma(round(x=y, 0), big.mark = ".",
                             decimal.mark = ","),
               vjust = 1.5, fontface = "bold"),
            position = position_dodge(0.9),
           size = 4, color = "white",
           family = "Roboto") +
  eje_y_n +
  scale_fill_manual(values = genero) +
  labs(title = "Salario promedio por puesto y género",
       subtitle = "Datos de Perú en S/",
       caption = paste0(fuente),
       fill = "Género",
       x = "", y = "Soles S/") + 
  estiloh
```

### Análisis por funciones

```{r peru_rol}
rh_pe %>% 
  group_by(funcion) %>% 
  summarise(sueldo_promedio = mean(sueldo_bruto)) %>% 
  ggplot(aes(x = sueldo_promedio, 
             y = reorder(funcion, sueldo_promedio))) +
  geom_col(fill = azul) +
  geom_text(aes(label = comma(round(sueldo_promedio, 0), 
                              big.mark = ".",
                             decimal.mark = ","),
            hjust = 1.5, fontface = "bold"),
            position = position_dodge(0.9),
            size = 3, color = "white",
            family = "Roboto") +
  eje_x_n +
  estilov +
  labs(title = "Sueldo promedio por función",
       subtitle = "Datos de Perú en S/",
       x = "Soles S/",
       y = "",
       caption = fuente) +
  theme(plot.title.position = "plot")
```


### Análisis por rubros

Veamos cuáles son los rubros mejor pagos en Perú

```{r peru_rubro}
rh_pe %>% 
  group_by(rubro) %>% 
  summarise(sueldo_promedio = mean(sueldo_bruto)) %>% 
  ggplot(aes(x = sueldo_promedio, 
             y = reorder(rubro, sueldo_promedio))) +
  geom_col(fill = azul) +
  geom_text(aes(label = comma(round(sueldo_promedio, 0), 
                              big.mark = ".",
                             decimal.mark = ","),
            hjust = 1.5, fontface = "bold"),
            position = position_dodge(0.9),
            size = 3, color = "white",
            family = "Roboto") +
  eje_x_n +
  estilov +
  labs(title = "Sueldo promedio por rubro",
       subtitle = "Datos de Perú en S/",
       x = "Soles S/",
       y = "",
       caption = fuente) +
  theme(plot.title.position = "plot")
```

