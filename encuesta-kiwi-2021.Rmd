---
title: "2° Encuesta KIWI de Sueldos de RRHH para Latam 2021"
author: "R4HR Club de R para RRHH"
date: "29/11/2021"
output: 
  html_document:
    theme: cosmo
    highlight: haddock
    toc: true
    toc_float: true
    code_folding: hide
    code_download: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, fig.retina = 3, out.width = "70%", fig.align = "center")
```

# Introducción

[R4HR Club de R para RRHH](https://r4hr.club) es una comunidad de aprendizaje de programación de R para profesionales y estudiantes que trabajen o quieran trabajar en RRHH.

Somos una comunidad que usa mayormente datos de ejemplo relacionados con RRHH, y que genera contenido en castellano para eliminar las barreras en el aprendizaje y facilitar que más personas adopten las herramientas de análisis de datos en sus trabajos.

Para saber más de nosotros te invitamos a leer [este post](https://r4hr.club/2020/09/23/el-club-de-r-para-rrhh/).

También podés ver todo el contenido que generamos en los siguientes links:

`r icons::fontawesome("google-drive")` [Google Drive](https://drive.google.com/drive/folders/1Qck3z_t6XLRXb2vbN-00931DgdJZ0yse?usp=sharing)

`r icons::fontawesome("youtube")` [YouTube](https://youtube.com/playlist?list=PLZuVytUJrxQlcqu6l-P3ou4vV2mRJU2Ka)

`r icons::fontawesome("github")` [Github](https://github.com/r4hr/)

`r icons::fontawesome("link")` También te invitamos a seguirnos en todas [nuestras redes sociales](https://linktr.ee/r4hrclub).

Pueden acceder a los datos crudos desde [este link](https://docs.google.com/spreadsheets/d/1LDdXlIwrcsyuywbcS4gdc-1p6wBXfEfL2Y6sNBj-4GM/edit?usp=sharing).

```{r preproceso}
# Carga de librerías 
# Instalar pacman install.packages("pacman")

pacman::p_load(tidyverse, funModeling, gt, googlesheets4,gt,
               extrafont, scales, ggalt, kableExtra, wordcloud, networkD3,
               data.table)


# Carga de Datos ----
# Datos --------

## 2021 ----

# Encuesta
kiwi21 <- read.csv("https://raw.githubusercontent.com/r4hr/kiwi2021/main/data/rh_2021.csv",
                   sep = ";",
                   encoding = "UTF-8") 

kiwi20 <- read.csv("https://raw.githubusercontent.com/r4hr/kiwi2021/main/data/rh_2020.csv", 
                   sep = ";",
                   encoding = "UTF-8")

freelo21 <- read.csv("https://raw.githubusercontent.com/r4hr/kiwi2021/main/data/freelancers_2021.csv",
                     sep = ";",
                     encoding = "UTF-8")

kiwi21_original <- read_sheet("1nhpqDWuJoWhiVj0rIaV51-SdfnSxTpbV3Vcd3iYmyTw")

# Configuraciones generales ----

options(scipen = 999)   # Modifica la visualización de los ejes numérico a valores nominales

loadfonts(quiet = TRUE) # Permite cargar en R otros tipos de fuentes.

# Estilo limpio sin líneas de fondo
estilo <- theme(panel.grid = element_blank(),
                plot.background = element_rect(fill = "#FBFCFC"),
                panel.background = element_blank(),
                text = element_text(family = "Roboto"))

# Estilo limpio con líneas de referencia verticales en gris claro
estilov <- theme(panel.grid = element_blank(),
                 plot.background = element_rect(fill = "#FBFCFC"),
                 panel.background = element_blank(),
                 panel.grid.major.x = element_line(color = "#AEB6BF"),
                 text = element_text(family = "Roboto"))

# Estilo limpio con líneas de referencia horizontales en gris claro
estiloh <- theme(panel.grid = element_blank(),
                 plot.background = element_rect(fill = "#FBFCFC"),
                 panel.background = element_blank(),
                 panel.grid.major.y = element_line(color = "#AEB6BF"),
                 text = element_text(family = "Roboto"))

genero <- c("#8624F5", "#1FC3AA", "#FFD129", "#75838F") #Violeta - Verde - Amarillo - Gris
genero3 <- c("#8624F5","#FFD129", "#1FC3AA")

colores <-  c("#8624F5", "#1FC3AA")

azul <- "#344D7E"
verde <-  "#4A9FC7"
rosa1 <- "#B95192"
rosa2 <- "#EE5777"
naranja <- "#FF764C"
amarillo <- "#FFA600"
gris <- "#75838F"
lila <- "#755395"
rojo <- "#943126"

col4 <- c(azul, lila, rosa1, rosa2)
col5 <- c(azul, lila, rosa1, rosa2, naranja)
col6 <- c(azul, lila, rosa1, rosa2, naranja, amarillo)

# Creo un objeto con un texto que se va a repetir mucho a lo largo del análisis
fuente <- "Fuente: Encuesta KIWI de Sueldos de RRHH para Latam 2021"

# Creo objetos para formatear las etiquetas numéricas de los ejes x e y
eje_x_n <- scale_x_continuous(labels = comma_format(big.mark = ".", decimal.mark = ","))

eje_y_n <- scale_y_continuous(labels = comma_format(big.mark = ".", decimal.mark = ","))


# Cantidad de respuestas 

rtas21 <- nrow(kiwi21_original)

rtas21_perc <- percent(1- (rtas21 / 762))

rtas_pais <- kiwi21_original %>% 
  select(pais = `País en el que trabajas`) %>% 
  distinct(pais) %>% 
  count() %>% 
  pull()
```

# Motivaciones

Como en RRHH trabajamos con datos sensibles, es complejo conseguir datos para practicar cuando estás aprendiendo sobre People Analytics, especialmente la parte práctica. Por eso, e inspirados en la Encuesta de [SysArmy](https://sysarmy.com/blog/posts/resultados-de-la-encuesta-de-sueldos-2020-2/), una comunidad de tecnología, que entre otras cosas, organiza eventos como **Nerdearla**.

Por esta razón hicimos nuestra propia encuesta, relevando datos de profesionales que trabajan tanto bajo relación de dependencia como de manera freelance. El relevamiento de datos lo hicimos entre el 22 de octubre y el 22 de noviembre de 2021.

En esta edición recibimos en total `r rtas21` respuestas (un `r rtas21_perc` menos que en 2020), de `r rtas_pais` países diferentes.

```{r rtas_pais_tabla}
kiwi21 %>% 
  group_by(pais) %>% 
  tally(sort = T) %>% 
  rename("País" = pais,
         "Respuestas" = n) %>% 
  kbl(caption = "Respuestas por País", ) %>% 
  kable_styling(full_width = F, position = "center",
                bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>% 
  footnote(general = fuente)
```

Del total de respuestas recibidas, `r nrow(kiwi21_original) - nrow(freelo21)` son de personas que trabajan en relación de dependencia en RRHH, mientras que `r nrow(freelo21)` personas trabajan de manera freelance.

```{r}
kiwi21_original %>% 
  select(Trabajo) %>% 
  group_by(Trabajo) %>% 
  count() %>% 
  ggplot(aes(x = n, y = Trabajo)) +
  geom_col(fill = azul) +
  estilov +
  geom_text(aes(label = n), # Indica la cantidad de decimales
            size = 3,       # Cambia el tamaño de la letra
            hjust = 1.2,    # Mueve la etiqueta para la izquierda
            color = "white",
            family = "Roboto") +
  labs(title = "Respuestas por tipo de trabajador", 
       x = "", y = "", 
       caption = fuente)
```

En esta edición decidimos realizar los análisis de género en términos de **Identidad de Género** para intentar abarcar con nuestro análisis la diversidad en términos de identidad de género. Es por esta razón que, a diferencia de la primera edición donde los análisis los hicimos en términos de *Mujer/Hombre* este año lo hicimos en términos de *Mujer cis/Mujer trans* y *Hombre cis/Hombre trans* para poder reflejar con mayor precisión el abánico de identidades y percepciones.

> El térmiino *"cis"* hace referencia a que la persona se identifica con el mismo género con el que nació.

Le agradecemos mucho a [Ivana Feldeberg](https://www.linkedin.com/in/ivana-feldfeber/) del [Observatorio de Datos con Perspectiva de Género](https://www.datagenero.org/) por el asesoramiento en este apartado.

Dicho esto, las respuestas según la identidad de género de las personas que participaron es la siguiente:

```{r fig.show='hold', out.width="50%", fig.align='default'}

# Gráfico para relación de dependencia----
div <- kiwi21 %>% 
  select(genero) %>% 
  mutate(genero = factor(genero, 
                         levels = c("Mujer cis", "Hombre cis", 
                                    "Prefiero no responder", "Gay"))) %>% 
  group_by(genero) %>% 
  summarise (n = n()) %>% 
  mutate(freq = n/sum(n)) %>% 
  arrange(-n)

# Compute the cumulative percentages (top of each rectangle)
div$ymax <- cumsum(div$freq)

# Compute the bottom of each rectangle
div$ymin <- c(0, head(div$ymax, n=-1))

# Compute label position
div$labelPosition <- (div$ymax + div$ymin) / 2

# Compute a good label
div$label <- paste0(div$genero, "\n Cant: ", div$n)

# Make the plot
ggplot(div, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=genero)) +
  geom_rect() +
  coord_polar(theta="y") + # Try to remove that to understand how the chart is built initially
  xlim(c(2, 4)) +# Try to remove that to see how to make a pie chart
  scale_fill_manual(values = c("#8624F5",  "#1FC3AA", "#FFD129","#75838F")) +
  theme_void() +
  theme(legend.position = "top",
        panel.background = element_blank(),
        plot.title.position = "plot",
        text = element_text(family = "Roboto")) +
  labs(title = "Cantidad de respuestas según género",
       subtitle = "Relación de Dependencia",
       fill = "Género", 
       caption = fuente)

# Gráfico de freelancers ----
freelo21 <- freelo21 %>% 
  mutate(genero = fct_collapse(genero, "Mujer cis" = c("Mujer cis", "Mujer"),
                               "Hombre cis" = c("Hombre cis")),
         genero = factor(genero, levels = c("Mujer cis", "Hombre cis",
                                             "Prefiero no responder", "No binario")))

div <- freelo21 %>% 
  select(genero) %>% 
  group_by(genero) %>% 
  summarise (n = n()) %>% 
  mutate(freq = n/sum(n)) %>% 
  arrange(-n)

# Compute the cumulative percentages (top of each rectangle)
div$ymax <- cumsum(div$freq)

# Compute the bottom of each rectangle
div$ymin <- c(0, head(div$ymax, n=-1))

# Compute label position
div$labelPosition <- (div$ymax + div$ymin) / 2

# Compute a good label
div$label <- paste0(div$genero, "\n Cant: ", div$n)

# Make the plot
ggplot(div, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=genero)) +
  geom_rect() +
  coord_polar(theta="y") + # Try to remove that to understand how the chart is built initially
  xlim(c(2, 4)) +# Try to remove that to see how to make a pie chart
  scale_fill_manual(values = c("#8624F5",  "#1FC3AA", "#FFD129","#75838F")) +
  theme_void() +
  theme(legend.position = "top",
        panel.background = element_blank(),
        plot.title.position = "plot",
        text = element_text(family = "Roboto")) +
  labs(title = "Cantidad de respuestas según género",
       subtitle = "Freelancers",
       fill = "Género", 
       caption = fuente)

```

En resumen, más de dos tercios de las personas que participaron de esta encuesta son mujeres cis. Algo que reflejan los datos es que en las áreas de Recursos Humanos, la diversidad de identidades de género es prácticamente nula.

```{r genero_participantes}
kiwi21_original %>% 
    mutate(genero = fct_collapse(`Identidad de Género`, "Mujer cis" = c("Mujer cis", "Mujer", "mujer",
                                                       "Mujer heterosexual"),
                               "Hombre cis" = c("Hombre cis", "Hombre", 
                                                "Hombre hetero. Que es cis?",
                                                "Hombre heterosexual")),
         genero = factor(genero, levels = c("Mujer cis", "Hombre cis",
                                            "Gay", "Prefiero no responder", "No binario"))) %>% 
  group_by(genero) %>% 
  tally(sort = T) %>% 
  mutate(Porcentaje = n/sum(n),
         Porcentaje = percent(Porcentaje, accuracy = 0.1)) %>% 
  rename("Género" = genero, 
         "Cantidad" = n) %>% 
  kbl(caption = "Total de Participantes según\nIdentidad de Género") %>% 
  kable_styling(full_width = F, position = "center",
                bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>% 
  footnote(general = fuente, general_title = "")
  


```
